<!DOCTYPE html>
<html>
<style>
  .container {
    position: relative;
    width: 100%;
    height: 100vh;
	user-select:none;
  }
</style>
<head>
  <link rel="icon" type="image/x-icon" href="images/favicon.ico">
</head>
<body>
  <div class="container">
	<h1>Start rolling!</h1>
    <img id="boulder" onclick="move(this)" src="images/boulder.png"></img>
    <input type="checkbox" id="keymash" name="keymash">
	<label for="keymash">Toggle Key Mash</label>
	<input type="checkbox" id="autoroll" name="autoroll" onclick="autoroll(this)">
	<label for="autoroll">Toggle Autoroll</label>
    <div>
	  <div>
	    <h2 style="position: relative; left: 900px;"><span id="funnybox"></span>
		<br><input type="checkbox" id="boulderviewbox" name="boulderview" style="visibility:hidden">
	    <label for="boulderviewbox"><span id="boulderview"></span></label></br></h2>
      </div>
	  <div>
        <h2><span id="distance" style="color:green"></span>
	    <br><span id="turns" style="color:blue"></span>
		<br><input type="button" id="spendrotation" name="spendrotation" onclick="spendrotation()" style="visibility:hidden">
		<label for="spendrotation"><span id="spendbox"></span></label>
		<br><input type="button" id="spenddepthtime" name="spenddepthtime" onclick="spenddepthtime()" style="visibility:hidden">
		<label for="spenddepthtime"><span id="spendboxdepthtime"></span></label>
		<br><span id="depth" style="color:yellow"></br></h2>
	  </div>
	</div>
  </div>
  <script>
  let rotateAngle = 0;
  let movement = 0;
  let bonusmovement = 15;
  let bonusrotation = 15;
  let verticalspeed = 45;
  let verticalposition = -15;
  let randomtime = 20;
  let maxdepth = 0;
  let rotationstored = 0;
  let totalrotations = 0;
  let rotationprice = 2;
  let depthtimeprice = 10;
  let prestigelevel = 0;
  let rolldelay = 1000;
  let trailcounter = 5;
  let timereduction = 1;
  const negate = -1;

  let funnybox = false;
  let imageviewbox = false;
  let manualclicking = true;
  let depthtimebox = false;
  
  //Keymash mode
  
  document.addEventListener('DOMContentLoaded', () => {
    const checkbox = document.getElementById('keymash');
	document.addEventListener('keyup', (event) => {
	  if(checkbox.checked) {
	    move(document.getElementById('boulder'));
		if (manualclicking) {
		  manualclicking = false;
		}
	  }
	});
  });
  
  //Automove
  function autoroll(checkbox) {
    if (checkbox.checked) {
      rollinterval = setInterval(() => move(document.getElementById('boulder')), rolldelay);
    } else {
      clearInterval(rollinterval);
    }
  }
  
  //Movement function
  function move(image) {
    movement = movement + bonusmovement;
	rotateAngle = rotateAngle + bonusrotation;
	if (totalrotations < Math.floor(rotateAngle/360)) {
	  rotationstored = rotationstored + Math.floor(rotateAngle/360) - totalrotations;
	}
	totalrotations = Math.floor(rotateAngle/360);
    if (movement < 10000) {
      image.setAttribute("style", "transform: translateX(" + movement + "px) rotate(" + rotateAngle + "deg);");
	} else {
	  image.setAttribute("style", "transform: translateX(" + movement + "px) translateY(" + verticalposition + "px) rotate(" + rotateAngle + "deg);");
    }
	document.getElementById('distance').innerHTML = "You have pushed for " + movement + " pixels!";
	if (totalrotations >= 1) {
	  document.getElementById('turns').innerHTML = "The boulder has " + rotationstored + " rotations stored!";
	  if (movement >= 10000) {
        if (randomtime <= 0) {
          randomtime = Math.random() * totalrotations;
		  verticalspeed = verticalspeed * negate;
		  if (verticalposition < 0) {
		    verticalposition = 0;
		  }
		  if (verticalspeed < 0) {
		    randomtime = randomtime * timereduction;
		  } else {
		    randomtime = randomtime * (2 - timereduction); 
		  }
        }
		verticalposition = verticalposition + verticalspeed;
		randomtime = randomtime - 1;
		if (maxdepth < verticalposition) {
		    maxdepth = verticalposition;
			// line doesnt work, supposed to place at very bottom of page
			document.getElementById('depth').setAttribute("style", "transform: translateY(" + maxdepth + "px);");
		  }
		document.getElementById('depth').innerHTML = "The boulder is getting unrooly, it has reached a depth of " + maxdepth + "!";
	  }
    }
	if (movement >= 900 && funnybox == false) {
	  funnybox = true;
	  document.getElementById('funnybox').innerHTML = "a nice start to a fun adventure!";
	  document.getElementById('boulderview').innerHTML = "Toggle Boulder View";
	  document.getElementById('boulderviewbox').style.visibility = 'visible';
	  document.getElementById('spendbox').innerHTML = " +5 movement | " + rotationprice + " rotations";
	  document.getElementById('spendrotation').style.visibility = 'visible';
	}
	if (maxdepth >= 2000 && depthtimebox == false) {
	  document.getElementById('spendboxdepthtime').innerHTML = timereduction + "x Upward travel time, " + (2 - timereduction) + "x Downward travel time | " + depthtimeprice + " rotations";
	  document.getElementById('spenddepthtime').style.visibility = 'visible';
	  depthtimebox = true;
	}
	if (movement >= 2000) {
	  trailcounter = trailcounter - 1;
	  if (trailcounter <= 0) {
	    trailcounter = 20;
	    createtrail(document.getElementById('boulder'),"images/flower1.png");
	  }
	}
	if (document.getElementById('boulderviewbox').checked) {
	  image.scrollIntoView();
	}
  }
  
  function spendrotation() {
    if (rotationstored >= rotationprice) {
	  rotationstored = rotationstored - rotationprice;
      upgrademovement(5);
	  rotationprice = rotationprice + Math.ceil(rotationprice / 2);
	  document.getElementById('spendbox').innerHTML = " +5 movement | " + rotationprice + " rotations";
	  document.getElementById('turns').innerHTML = "The boulder has " + rotationstored + " rotations stored!";
    }
  }
  
  function spenddepthtime() {
    if (timereduction > 0) {
      if (rotationstored >= depthtimeprice) {
	    rotationstored = rotationstored - depthtimeprice;
        timereduction = timereduction * 0.9;
	    depthtimeprice = depthtimeprice * depthtimeprice;
	    document.getElementById('spendboxdepthtime').innerHTML = timereduction + "x Upward travel time, " + (2 - timereduction) + "x Downward travel time | " + depthtimeprice + " rotations";
	    document.getElementById('turns').innerHTML = "The boulder has " + rotationstored + " rotations stored!";
     }
	}
  }
  
  function createtrail(space,image) {
    trail = document.createElement('img');
	trail.src = image;
	trail.style.transform = window.getComputedStyle(space).transform;
	document.body.appendChild(trail);
  }
  
  function upgrademovement(amount)  {
    bonusmovement = bonusmovement + amount;
	bonusrotation = bonusrotation + amount;
  }
  
  function prestige() {
	prestigecurrent = Math.log(movement) + Math.log(maxdepth);
	if (prestigelevel < prestigecurrent) {
	  prestigelevel = prestigecurrent;
	}
    rotateAngle = 0;
    movement = 0;
    bonusmovement = 15 + prestigelevel * (prestigelevel/2);
    bonusrotation = 15 + prestigelevel * (prestigelevel/2);
    verticalspeed = 45;
    verticalposition = -15;
    randomtime = 20;
    maxdepth = 0;
    rotationstored = 0;
    totalrotations = 0;
    rotationprice = 2;
  }
  
  </script>
</body>
</html>
